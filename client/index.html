<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audio Transcription API - Frontend</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <style>
        .tab-button {
            @apply flex-1 px-4 py-2 text-sm font-medium text-gray-600 rounded-md transition-colors duration-200 hover:text-gray-800;
        }
        .tab-button.active {
            @apply bg-blue-500 text-white shadow-sm;
        }
        .tab-content {
            @apply transition-opacity duration-200;
        }
        .status-badge {
            @apply inline-block w-3 h-3 rounded-full;
        }
        .status-transcription { @apply bg-yellow-400; }
        .status-review { @apply bg-orange-400; }
        .status-approval { @apply bg-blue-400; }
        .status-completed { @apply bg-green-400; }
        .status-rejected { @apply bg-red-400; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-7xl">
        <!-- Header -->
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-800 mb-2">ğŸµ Audio Transcription API</h1>
            <p class="text-gray-600">Test the transcription API endpoints and workflow engine</p>
        </header>

        <!-- Navigation Tabs -->
        <div class="mb-8">
            <nav class="flex space-x-1 bg-white rounded-lg p-1 shadow">
                <button id="tab-transcription" class="tab-button active" onclick="showTab('transcription')">
                    ğŸ“ Transcription
                </button>
                <button id="tab-workflow" class="tab-button" onclick="showTab('workflow')">
                    ğŸ”„ Workflow Engine
                </button>
                <button id="tab-statistics" class="tab-button" onclick="showTab('statistics')">
                    ğŸ“Š Statistics
                </button>
            </nav>
        </div>

        <!-- Status Messages -->
        <div id="statusMessage" class="mb-6 hidden">
            <div id="statusContent" class="p-4 rounded-lg"></div>
        </div>

        <!-- Transcription Tab -->
        <div id="content-transcription" class="tab-content">
            <div class="grid md:grid-cols-2 gap-8">
                <!-- Left Column: Create Transcription -->
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h2 class="text-2xl font-semibold text-gray-800 mb-4">ğŸµ Create Transcription</h2>
                    
                    <!-- Audio URL Input -->
                    <div class="mb-4">
                        <label for="audioUrl" class="block text-sm font-medium text-gray-700 mb-2">Audio URL</label>
                        <input 
                            type="url" 
                            id="audioUrl" 
                            placeholder="https://example.com/sample.mp3"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                            value="https://example.com/sample.mp3"
                        />
                    </div>

                    <!-- Language Selection -->
                    <div class="mb-4">
                        <label for="language" class="block text-sm font-medium text-gray-700 mb-2">Language</label>
                        <select 
                            id="language" 
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                        >
                            <option value="en-US">ğŸ‡ºğŸ‡¸ English (US)</option>
                            <option value="fr-FR">ğŸ‡«ğŸ‡· French (France)</option>
                            <option value="es-ES">ğŸ‡ªğŸ‡¸ Spanish (Spain)</option>
                            <option value="de-DE">ğŸ‡©ğŸ‡ª German (Germany)</option>
                            <option value="it-IT">ğŸ‡®ğŸ‡¹ Italian (Italy)</option>
                            <option value="pt-BR">ğŸ‡§ğŸ‡· Portuguese (Brazil)</option>
                            <option value="ja-JP">ğŸ‡¯ğŸ‡µ Japanese (Japan)</option>
                            <option value="ko-KR">ğŸ‡°ğŸ‡· Korean (South Korea)</option>
                            <option value="zh-CN">ğŸ‡¨ğŸ‡³ Chinese (China)</option>
                        </select>
                    </div>

                    <!-- Buttons -->
                    <div class="space-y-3">
                        <button 
                            onclick="createMockTranscription()" 
                            class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition duration-200"
                        >
                            ğŸ¯ Create Mock Transcription
                        </button>
                        
                        <button 
                            onclick="createAzureTranscription()" 
                            class="w-full bg-purple-600 hover:bg-purple-700 text-white font-medium py-2 px-4 rounded-md transition duration-200"
                        >
                            â˜ï¸ Create Azure Transcription
                        </button>
                    </div>

                    <!-- Recent Result -->
                    <div id="recentResult" class="mt-6 hidden">
                        <h3 class="text-lg font-semibold text-gray-800 mb-2">ğŸ“„ Recent Result</h3>
                        <div id="resultContent" class="bg-gray-50 p-3 rounded border text-sm"></div>
                    </div>
                </div>

                <!-- Right Column: View Transcriptions -->
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-semibold text-gray-800">ğŸ“Š Recent Transcriptions</h2>
                        <button 
                            onclick="loadTranscriptions()" 
                            class="bg-green-600 hover:bg-green-700 text-white font-medium py-1 px-3 rounded text-sm transition duration-200"
                        >
                            ğŸ”„ Refresh
                        </button>
                    </div>

                    <!-- Transcriptions List -->
                    <div id="transcriptionsList" class="space-y-3 max-h-96 overflow-y-auto">
                        <p class="text-gray-500 text-center py-4">Click refresh to load transcriptions</p>
                    </div>

                    <!-- Pagination -->
                    <div id="pagination" class="mt-4 flex justify-between items-center text-sm text-gray-600 hidden">
                        <div id="paginationInfo"></div>
                        <div class="space-x-2">
                            <button 
                                id="prevPage" 
                                onclick="changePage(-1)" 
                                class="px-3 py-1 bg-gray-200 rounded hover:bg-gray-300 disabled:opacity-50"
                            >
                                Previous
                            </button>
                            <button 
                                id="nextPage" 
                                onclick="changePage(1)" 
                                class="px-3 py-1 bg-gray-200 rounded hover:bg-gray-300 disabled:opacity-50"
                            >
                                Next
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Workflow Tab -->
        <div id="content-workflow" class="tab-content hidden">
            <div class="grid lg:grid-cols-3 gap-8">
                <!-- Left Column: Create Workflow -->
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h2 class="text-2xl font-semibold text-gray-800 mb-4">ğŸš€ Create Workflow</h2>
                    
                    <!-- Audio URL Input -->
                    <div class="mb-4">
                        <label for="workflowAudioUrl" class="block text-sm font-medium text-gray-700 mb-2">Audio URL</label>
                        <input 
                            type="url" 
                            id="workflowAudioUrl" 
                            placeholder="https://example.com/workflow-audio.mp3"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500"
                            value="https://example.com/workflow-demo.mp3"
                        />
                    </div>

                    <!-- Language Selection -->
                    <div class="mb-4">
                        <label for="workflowLanguage" class="block text-sm font-medium text-gray-700 mb-2">Language</label>
                        <select 
                            id="workflowLanguage" 
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500"
                        >
                            <option value="en-US">ğŸ‡ºğŸ‡¸ English (US)</option>
                            <option value="fr-FR">ğŸ‡«ğŸ‡· French (France)</option>
                            <option value="es-ES">ğŸ‡ªğŸ‡¸ Spanish (Spain)</option>
                        </select>
                    </div>

                    <!-- Create Workflow Button -->
                    <button 
                        onclick="createWorkflow()" 
                        class="w-full bg-purple-600 hover:bg-purple-700 text-white font-medium py-2 px-4 rounded-md transition duration-200 mb-4"
                    >
                        ğŸ”„ Start New Workflow
                    </button>

                    <!-- Workflow Status Legend -->
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h3 class="text-sm font-semibold text-gray-700 mb-2">Workflow States</h3>
                        <div class="space-y-2 text-sm">
                            <div class="flex items-center">
                                <span class="status-badge status-transcription mr-2"></span>
                                Transcription
                            </div>
                            <div class="flex items-center">
                                <span class="status-badge status-review mr-2"></span>
                                Review
                            </div>
                            <div class="flex items-center">
                                <span class="status-badge status-approval mr-2"></span>
                                Approval
                            </div>
                            <div class="flex items-center">
                                <span class="status-badge status-completed mr-2"></span>
                                Completed
                            </div>
                            <div class="flex items-center">
                                <span class="status-badge status-rejected mr-2"></span>
                                Rejected
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Middle Column: Workflow List -->
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-semibold text-gray-800">ğŸ”„ Active Workflows</h2>
                        <button 
                            onclick="loadWorkflows()" 
                            class="bg-purple-600 hover:bg-purple-700 text-white font-medium py-1 px-3 rounded text-sm transition duration-200"
                        >
                            ğŸ”„ Refresh
                        </button>
                    </div>

                    <!-- Status Filter -->
                    <div class="mb-4">
                        <select 
                            id="statusFilter" 
                            onchange="loadWorkflows()"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-purple-500"
                        >
                            <option value="">All Status</option>
                            <option value="transcription">Transcription</option>
                            <option value="review">Review</option>
                            <option value="approval">Approval</option>
                            <option value="completed">Completed</option>
                            <option value="rejected">Rejected</option>
                        </select>
                    </div>

                    <!-- Workflows List -->
                    <div id="workflowsList" class="space-y-3 max-h-96 overflow-y-auto">
                        <p class="text-gray-500 text-center py-4">Click refresh to load workflows</p>
                    </div>
                </div>

                <!-- Right Column: Workflow Details -->
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h2 class="text-2xl font-semibold text-gray-800 mb-4">ğŸ“‹ Workflow Details</h2>
                    
                    <div id="workflowDetails" class="space-y-4">
                        <p class="text-gray-500 text-center py-8">Select a workflow to view details</p>
                    </div>

                    <!-- Manual Transition Controls -->
                    <div id="transitionControls" class="mt-6 hidden">
                        <h3 class="text-lg font-semibold text-gray-800 mb-3">Manual Transition</h3>
                        <div class="space-y-3">
                            <div>
                                <label for="newStatus" class="block text-sm font-medium text-gray-700 mb-1">New Status</label>
                                <select id="newStatus" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm">
                                    <option value="">Select status...</option>
                                </select>
                            </div>
                            <div>
                                <label for="transitionComment" class="block text-sm font-medium text-gray-700 mb-1">Comment</label>
                                <textarea 
                                    id="transitionComment" 
                                    placeholder="Optional comment..."
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm resize-none"
                                    rows="2"
                                ></textarea>
                            </div>
                            <div>
                                <label for="reviewedBy" class="block text-sm font-medium text-gray-700 mb-1">Reviewed By</label>
                                <input 
                                    type="text" 
                                    id="reviewedBy" 
                                    placeholder="Your name"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm"
                                    value="Demo User"
                                />
                            </div>
                            <button 
                                onclick="transitionWorkflow()" 
                                class="w-full bg-orange-600 hover:bg-orange-700 text-white font-medium py-2 px-4 rounded-md transition duration-200"
                            >
                                âš¡ Apply Transition
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Statistics Tab -->
        <div id="content-statistics" class="tab-content hidden">
            <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <!-- Workflow Stats Cards -->
                <div class="bg-white rounded-lg shadow-lg p-6 text-center">
                    <div class="text-3xl font-bold text-yellow-600" id="stat-transcription">-</div>
                    <div class="text-sm text-gray-600 mt-1">Transcription</div>
                </div>
                <div class="bg-white rounded-lg shadow-lg p-6 text-center">
                    <div class="text-3xl font-bold text-orange-600" id="stat-review">-</div>
                    <div class="text-sm text-gray-600 mt-1">Review</div>
                </div>
                <div class="bg-white rounded-lg shadow-lg p-6 text-center">
                    <div class="text-3xl font-bold text-blue-600" id="stat-approval">-</div>
                    <div class="text-sm text-gray-600 mt-1">Approval</div>
                </div>
                <div class="bg-white rounded-lg shadow-lg p-6 text-center">
                    <div class="text-3xl font-bold text-green-600" id="stat-completed">-</div>
                    <div class="text-sm text-gray-600 mt-1">Completed</div>
                </div>
            </div>
            
            <div class="bg-white rounded-lg shadow-lg p-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-semibold text-gray-800">ğŸ“Š Workflow Statistics</h2>
                    <button 
                        onclick="loadStatistics()" 
                        class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-1 px-3 rounded text-sm transition duration-200"
                    >
                        ğŸ”„ Refresh
                    </button>
                </div>
                <div id="statisticsContent">
                    <p class="text-gray-500 text-center py-8">Click refresh to load statistics</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const API_BASE_URL = 'http://localhost:3001';
        let currentPage = 1;
        let totalPages = 1;
        let selectedWorkflowId = null;

        // Tab Management
        function showTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            // Remove active class from all tab buttons
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(`content-${tabName}`).classList.remove('hidden');
            
            // Add active class to selected tab button
            document.getElementById(`tab-${tabName}`).classList.add('active');
            
            // Load data for the selected tab
            if (tabName === 'workflow') {
                loadWorkflows();
            } else if (tabName === 'statistics') {
                loadStatistics();
            }
        }

        // Utility Functions
        function showStatus(message, type = 'info') {
            const statusDiv = document.getElementById('statusMessage');
            const statusContent = document.getElementById('statusContent');
            
            const bgColor = {
                success: 'bg-green-100 border-green-400 text-green-700',
                error: 'bg-red-100 border-red-400 text-red-700',
                info: 'bg-blue-100 border-blue-400 text-blue-700'
            }[type] || 'bg-gray-100 border-gray-400 text-gray-700';
            
            statusContent.className = `p-4 rounded-lg border ${bgColor}`;
            statusContent.textContent = message;
            statusDiv.classList.remove('hidden');
            
            setTimeout(() => {
                statusDiv.classList.add('hidden');
            }, 5000);
        }

        function formatDate(dateString) {
            return new Date(dateString).toLocaleString();
        }

        // Language code to flag/name mapping
        const languageNames = {
            'en-US': 'ğŸ‡ºğŸ‡¸ English',
            'fr-FR': 'ğŸ‡«ğŸ‡· French', 
            'es-ES': 'ğŸ‡ªğŸ‡¸ Spanish',
            'de-DE': 'ğŸ‡©ğŸ‡ª German',
            'it-IT': 'ğŸ‡®ğŸ‡¹ Italian',
            'pt-BR': 'ğŸ‡§ğŸ‡· Portuguese',
            'ja-JP': 'ğŸ‡¯ğŸ‡µ Japanese',
            'ko-KR': 'ğŸ‡°ğŸ‡· Korean',
            'zh-CN': 'ğŸ‡¨ğŸ‡³ Chinese'
        };

        // Transcription API Functions
        async function createMockTranscription() {
            const audioUrl = document.getElementById('audioUrl').value.trim();
            const language = document.getElementById('language').value;
            
            if (!audioUrl) {
                showStatus('Please enter an audio URL', 'error');
                return;
            }

            try {
                showStatus(`Creating mock transcription (${language})...`, 'info');
                const response = await axios.post(`${API_BASE_URL}/transcription`, { audioUrl, language });
                
                showStatus('Mock transcription created successfully!', 'success');
                displayResult(response.data, 'Mock Transcription', language);
                loadTranscriptions();
            } catch (error) {
                const message = error.response?.data?.message || error.message;
                showStatus(`Error: ${message}`, 'error');
            }
        }

        async function createAzureTranscription() {
            const audioUrl = document.getElementById('audioUrl').value.trim();
            const language = document.getElementById('language').value;
            
            if (!audioUrl) {
                showStatus('Please enter an audio URL', 'error');
                return;
            }

            try {
                showStatus(`Creating Azure transcription (${language})...`, 'info');
                const response = await axios.post(`${API_BASE_URL}/azure-transcription`, { audioUrl, language });
                
                showStatus('Azure transcription created successfully!', 'success');
                displayResult(response.data, 'Azure Transcription', language);
                loadTranscriptions();
            } catch (error) {
                const message = error.response?.data?.message || error.message;
                showStatus(`Error: ${message}`, 'error');
            }
        }

        async function loadTranscriptions() {
            try {
                showStatus('Loading transcriptions...', 'info');
                const response = await axios.get(`${API_BASE_URL}/transcriptions?page=${currentPage}&limit=5`);
                
                displayTranscriptions(response.data.data);
                updatePagination(response.data.pagination);
                showStatus('Transcriptions loaded successfully', 'success');
            } catch (error) {
                const message = error.response?.data?.message || error.message;
                showStatus(`Error loading transcriptions: ${message}`, 'error');
            }
        }

        function displayResult(result, type, language) {
            const resultDiv = document.getElementById('recentResult');
            const resultContent = document.getElementById('resultContent');
            
            resultContent.innerHTML = `
                <div class="space-y-2">
                    <div><strong>Type:</strong> ${type}</div>
                    <div><strong>Language:</strong> ${languageNames[language] || language || 'en-US'}</div>
                    <div><strong>ID:</strong> ${result.id}</div>
                    <div><strong>Message:</strong> ${result.message}</div>
                    <div><strong>Timestamp:</strong> ${formatDate(new Date().toISOString())}</div>
                </div>
            `;
            
            resultDiv.classList.remove('hidden');
        }

        function displayTranscriptions(transcriptions) {
            const listDiv = document.getElementById('transcriptionsList');
            
            if (!transcriptions || transcriptions.length === 0) {
                listDiv.innerHTML = '<p class="text-gray-500 text-center py-4">No transcriptions found for the last 30 days</p>';
                return;
            }
            
            const html = transcriptions.map(t => `
                <div class="border border-gray-200 rounded-lg p-3 hover:bg-gray-50">
                    <div class="flex justify-between items-start mb-2">
                        <div class="text-sm font-medium text-gray-800 truncate flex-1">${t.audioUrl}</div>
                        <div class="flex items-center space-x-2">
                            ${t.language ? `<span class="px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-700">${languageNames[t.language] || t.language}</span>` : ''}
                            <span class="px-2 py-1 text-xs rounded-full ${t.source === 'azure' ? 'bg-purple-100 text-purple-800' : 'bg-blue-100 text-blue-800'}">${t.source || 'mock'}</span>
                        </div>
                    </div>
                    <div class="text-sm text-gray-600 mb-2">${t.transcription}</div>
                    <div class="text-xs text-gray-500">${formatDate(t.createdAt)}</div>
                </div>
            `).join('');
            
            listDiv.innerHTML = html;
        }

        function updatePagination(pagination) {
            if (!pagination) return;
            
            currentPage = pagination.page;
            totalPages = pagination.totalPages;
            
            const paginationDiv = document.getElementById('pagination');
            const infoDiv = document.getElementById('paginationInfo');
            const prevBtn = document.getElementById('prevPage');
            const nextBtn = document.getElementById('nextPage');
            
            infoDiv.textContent = `Page ${currentPage} of ${totalPages} (${pagination.total} total)`;
            
            prevBtn.disabled = currentPage <= 1;
            nextBtn.disabled = currentPage >= totalPages;
            
            if (pagination.total > pagination.limit) {
                paginationDiv.classList.remove('hidden');
            } else {
                paginationDiv.classList.add('hidden');
            }
        }

        function changePage(direction) {
            const newPage = currentPage + direction;
            if (newPage >= 1 && newPage <= totalPages) {
                currentPage = newPage;
                loadTranscriptions();
            }
        }
        
        // Workflow Engine Functions
        async function createWorkflow() {
            const audioUrl = document.getElementById('workflowAudioUrl').value.trim();
            const language = document.getElementById('workflowLanguage').value;
            
            if (!audioUrl) {
                showStatus('Please enter an audio URL', 'error');
                return;
            }

            try {
                showStatus(`Creating workflow (${language})...`, 'info');
                const response = await axios.post(`${API_BASE_URL}/workflow`, { audioUrl, language });
                
                showStatus('Workflow created successfully!', 'success');
                loadWorkflows();
                selectWorkflow(response.data.data.id);
            } catch (error) {
                const message = error.response?.data?.message || error.message;
                showStatus(`Error: ${message}`, 'error');
            }
        }

        async function loadWorkflows() {
            try {
                const statusFilter = document.getElementById('statusFilter').value;
                const url = `${API_BASE_URL}/workflows?limit=10${statusFilter ? `&status=${statusFilter}` : ''}`;
                
                const response = await axios.get(url);
                displayWorkflows(response.data.data.workflows);
                showStatus('Workflows loaded successfully', 'success');
            } catch (error) {
                const message = error.response?.data?.message || error.message;
                showStatus(`Error loading workflows: ${message}`, 'error');
            }
        }

        async function selectWorkflow(workflowId) {
            try {
                selectedWorkflowId = workflowId;
                const response = await axios.get(`${API_BASE_URL}/workflow/${workflowId}`);
                displayWorkflowDetails(response.data.data);
            } catch (error) {
                const message = error.response?.data?.message || error.message;
                showStatus(`Error loading workflow details: ${message}`, 'error');
            }
        }

        async function transitionWorkflow() {
            if (!selectedWorkflowId) {
                showStatus('Please select a workflow first', 'error');
                return;
            }

            const newStatus = document.getElementById('newStatus').value;
            const comment = document.getElementById('transitionComment').value;
            const reviewedBy = document.getElementById('reviewedBy').value;

            if (!newStatus) {
                showStatus('Please select a new status', 'error');
                return;
            }

            try {
                showStatus(`Transitioning workflow to ${newStatus}...`, 'info');
                await axios.put(`${API_BASE_URL}/workflow/${selectedWorkflowId}/transition`, {
                    newStatus,
                    comment,
                    reviewedBy
                });
                
                showStatus('Workflow transitioned successfully!', 'success');
                loadWorkflows();
                selectWorkflow(selectedWorkflowId);
            } catch (error) {
                const message = error.response?.data?.message || error.message;
                showStatus(`Error: ${message}`, 'error');
            }
        }

        async function loadStatistics() {
            try {
                const response = await axios.get(`${API_BASE_URL}/workflow/stats`);
                displayStatistics(response.data.data);
                showStatus('Statistics loaded successfully', 'success');
            } catch (error) {
                const message = error.response?.data?.message || error.message;
                showStatus(`Error loading statistics: ${message}`, 'error');
            }
        }

        function displayWorkflows(workflows) {
            const listDiv = document.getElementById('workflowsList');
            
            if (!workflows || workflows.length === 0) {
                listDiv.innerHTML = '<p class="text-gray-500 text-center py-4">No workflows found</p>';
                return;
            }
            
            const html = workflows.map(w => `
                <div class="border border-gray-200 rounded-lg p-3 hover:bg-purple-50 cursor-pointer transition-colors"
                     onclick="selectWorkflow('${w._id}')">
                    <div class="flex justify-between items-center mb-2">
                        <div class="text-sm font-medium text-gray-800 truncate flex-1">${w.audioUrl}</div>
                        <span class="status-badge status-${w.workflowStatus || 'transcription'} ml-2"></span>
                    </div>
                    <div class="flex justify-between items-center text-xs text-gray-500">
                        <span>${w.workflowStatus || 'transcription'}</span>
                        <span>${formatDate(w.createdAt)}</span>
                    </div>
                </div>
            `).join('');
            
            listDiv.innerHTML = html;
        }

        function displayWorkflowDetails(workflow) {
            const detailsDiv = document.getElementById('workflowDetails');
            const controlsDiv = document.getElementById('transitionControls');
            
            const html = `
                <div class="space-y-4">
                    <div>
                        <h3 class="text-lg font-semibold text-gray-800 mb-2">Current Status</h3>
                        <div class="flex items-center">
                            <span class="status-badge status-${workflow.currentStatus} mr-2"></span>
                            <span class="capitalize font-medium">${workflow.currentStatus}</span>
                        </div>
                    </div>
                    
                    <div>
                        <h3 class="text-lg font-semibold text-gray-800 mb-2">Workflow ID</h3>
                        <p class="text-sm text-gray-600 break-all">${workflow.id}</p>
                    </div>
                    
                    <div>
                        <h3 class="text-lg font-semibold text-gray-800 mb-2">Workflow History</h3>
                        <div class="space-y-2 max-h-40 overflow-y-auto">
                            ${workflow.workflowHistory.map(h => `
                                <div class="text-xs bg-gray-50 p-2 rounded">
                                    <div class="flex justify-between items-center mb-1">
                                        <span class="font-medium">${h.status}</span>
                                        <span class="text-gray-500">${formatDate(h.timestamp)}</span>
                                    </div>
                                    ${h.comment ? `<p class="text-gray-600">${h.comment}</p>` : ''}
                                    ${h.reviewedBy ? `<p class="text-gray-500">By: ${h.reviewedBy}</p>` : ''}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
            
            detailsDiv.innerHTML = html;
            
            // Update transition controls
            const newStatusSelect = document.getElementById('newStatus');
            newStatusSelect.innerHTML = '<option value="">Select status...</option>' +
                workflow.canTransition.map(status => `<option value="${status}">${status}</option>`).join('');
            
            if (workflow.canTransition.length > 0) {
                controlsDiv.classList.remove('hidden');
            } else {
                controlsDiv.classList.add('hidden');
            }
        }

        function displayStatistics(stats) {
            // Update stat cards
            document.getElementById('stat-transcription').textContent = stats.statistics.transcription || 0;
            document.getElementById('stat-review').textContent = stats.statistics.review || 0;
            document.getElementById('stat-approval').textContent = stats.statistics.approval || 0;
            document.getElementById('stat-completed').textContent = stats.statistics.completed || 0;
            
            // Update content area
            const contentDiv = document.getElementById('statisticsContent');
            contentDiv.innerHTML = `
                <div class="grid grid-cols-2 gap-4 text-sm">
                    <div>
                        <h3 class="font-semibold text-gray-800 mb-2">Status Breakdown</h3>
                        <div class="space-y-1">
                            <div class="flex justify-between">
                                <span>Transcription:</span>
                                <span>${stats.statistics.transcription || 0}</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Review:</span>
                                <span>${stats.statistics.review || 0}</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Approval:</span>
                                <span>${stats.statistics.approval || 0}</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Completed:</span>
                                <span>${stats.statistics.completed || 0}</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Rejected:</span>
                                <span>${stats.statistics.rejected || 0}</span>
                            </div>
                        </div>
                    </div>
                    <div>
                        <h3 class="font-semibold text-gray-800 mb-2">Summary</h3>
                        <div class="space-y-1">
                            <div class="flex justify-between">
                                <span>Total Workflows:</span>
                                <span class="font-semibold">${stats.total}</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Active (In Progress):</span>
                                <span>${(stats.statistics.transcription || 0) + (stats.statistics.review || 0) + (stats.statistics.approval || 0)}</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Completion Rate:</span>
                                <span>${stats.total > 0 ? Math.round(((stats.statistics.completed || 0) / stats.total) * 100) : 0}%</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
    </script>
</body>
</html>
